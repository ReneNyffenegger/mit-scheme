### -*- Fundamental -*-
###
###	$Id: makefile.emx,v 1.5 1995/10/30 08:08:32 cph Exp $
###
###	Copyright (c) 1994-95 Massachusetts Institute of Technology
###
###	This material was developed by the Scheme project at the
###	Massachusetts Institute of Technology, Department of
###	Electrical Engineering and Computer Science.  Permission to
###	copy this software, to redistribute it, and to use it for any
###	purpose is granted, subject to the following restrictions and
###	understandings.
###
###	1. Any copy made of this software must include this copyright
###	notice in full.
###
###	2. Users of this software agree to make their best efforts (a)
###	to return to the MIT Scheme project any improvements or
###	extensions that they make, so that these may be included in
###	future releases; and (b) to inform MIT of noteworthy uses of
###	this software.
###
###	3. All materials developed as a consequence of the use of this
###	software shall duly acknowledge such use, in accordance with
###	the usual standards of acknowledging credit in academic
###	research.
###
###	4. MIT has made no warrantee or representation that the
###	operation of this software will be error-free, and MIT is
###	under no obligation to provide any services, by way of
###	maintenance, update, or otherwise.
###
###	5. In conjunction with products arising from the use of this
###	material, there shall be no use of the name of the
###	Massachusetts Institute of Technology nor of any adaptation
###	thereof in any advertising, promotional, or sales literature
###	without prior written consent from MIT in each case.
###

#### Makefile for Scheme under OS/2 using EMX/GCC

# This makefile is configured for use with GNU make, the EMX/GCC
# development system (compiler, assembler, linker, etc.), the GNU m4
# macro preprocessor, and the RC program included with the IBM OS/2
# Toolkit.

OBJ = o
ASM = s
CC = gcc
GCCFLAGS = -Zmt -O -g
CFLAGS = $(GCCFLAGS) -DMIT_SCHEME -D__OS2__
LDFLAGS = $(GCCFLAGS)
M4 = m4
M4FLAGS = -DTYPE_CODE_LENGTH=6
AS = as
ASFLAGS =

%.o : %.c
	$(CC) $(CFLAGS) -c $< -o $@

%.s : %.m4
	$(M4) $(M4FLAGS) < $< > $@

%.o : %.s
	$(AS) $(ASFLAGS) -o $@ $<

%.res : %.rc
	rc -r $<

%.exe :
	$(CC) $(LDFLAGS) -o $(basename $@) $^
	emxbind -bq $(basename $@)
	del $(basename $@)

include os2utl\makefile.cmn

scheme.exe : $(OBJECTS) $(SCHEME_OBJECTS) os2pmcon.res
	$(CC) $(LDFLAGS) -o $(basename $@) \
	$(OBJECTS) $(SCHEME_OBJECTS) $(SCHEME_LIB)
	emxbind -bpq $(basename $@) -ros2pmcon.res
	del $(basename $@)

bchschem.exe : $(BCHOBJECTS) $(SCHEME_OBJECTS)
	$(CC) $(LDFLAGS) -o $(basename $@) \
	$(OBJECTS) $(SCHEME_OBJECTS) $(SCHEME_LIB)
	emxbind -bpq $(basename $@) -ros2pmcon.res
	del $(basename $@)
